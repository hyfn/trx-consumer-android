apply plugin: 'com.android.application'
apply plugin: 'kotlin-android'
apply plugin: 'kotlin-kapt'
apply plugin: 'kotlin-parcelize'
apply plugin: 'dagger.hilt.android.plugin'
apply plugin: "androidx.navigation.safeargs.kotlin"
apply from: 'ktlint.gradle'
apply from: 'jacoco.gradle'


android {
    compileSdkVersion rootProject.compileSdkVersion
    buildToolsVersion rootProject.buildToolsVersion

    buildFeatures {
        viewBinding true
    }

    signingConfigs {
        signingConfigs {
            devRelease {
                storeFile file("../extra/keystores/dev.keystore")
                keyPassword System.getenv('DEV_KEYPASS')
                storePassword System.getenv('DEV_STOREPASS')
                keyAlias System.getenv('DEV_KEYALIAS')
            }

            prodRelease {
                storeFile file("../extra/keystores/prod.keystore")
                keyPassword System.getenv('PROD_KEYPASS')
                storePassword System.getenv('PROD_STOREPASS')
                keyAlias System.getenv('PROD_KEYALIAS')
            }
        }
    }

    defaultConfig {
        applicationId "com.trx.consumer"
        minSdkVersion rootProject.minSdkVersion
        targetSdkVersion rootProject.targetSdkVersion
        versionCode 1
        versionName "0.0.0"
        multiDexEnabled true
        vectorDrawables.useSupportLibrary = true
        testInstrumentationRunner "androidx.test.runner.AndroidJUnitRunner"

        compileOptions {
            coreLibraryDesugaringEnabled true
            sourceCompatibility JavaVersion.VERSION_1_8
            targetCompatibility JavaVersion.VERSION_1_8
        }

        kotlinOptions {
            jvmTarget = JavaVersion.VERSION_1_8
        }
    }

    lintOptions {
        checkReleaseBuilds true
        abortOnError false
        error("VisibleForTests")
    }

    buildTypes {
        release {
            minifyEnabled false
            proguardFiles getDefaultProguardFile('proguard-android-optimize.txt'), 'proguard-rules.pro'
            resValue "bool", "debug", "false"
        }
        debug {
            resValue "bool", "debug", "true"
        }
    }

    flavorDimensions "default"
    productFlavors {
        all {
            buildConfigField "String", "kPlatform", '"mobile"'
            buildConfigField "String", "kClassDateTimeFormat", '"yyyy-MM-dd\'T\'HH:mm:ss.SSSX"'
            buildConfigField "Integer", "kVerificationCodeLimit", "6"
            buildConfigField "Integer", "kExpirationDateLimit", "7"
            buildConfigField "Integer", "kCreditCardLengthStandard", "16"
            buildConfigField "Integer", "kCreditCardLengthAmex", "15"
            buildConfigField "Integer", "kCVCLimit", "3"
            buildConfigField "Integer", "kZipcodeMinLength", "5"
            buildConfigField "Integer", "kDefaultTextLimit", "40"
            buildConfigField "Integer", "kPasswordMinLength", "6"
            buildConfigField "String", "isMaintenanceMode", '"is_maintenance_mode"'
            buildConfigField "String", "minimumBuildNumber", '"minimum_build_number"'
            buildConfigField "String", "trxUrl", '"http://trx.sprintfwd.com"'
            buildConfigField "String", "kBrightcoveAccountId", '"6204326362001"'
            buildConfigField "String", "kBrightcovePolicyKey", '"BCpkADawqM0NIVZ3stgK7lsrNpSnMb54yV2-XP_RMBl9gBL5hOvH_cjmnfU_kxS1QjYqucj3ZQTBRiGZhrd09drVaY-IAEgg9IYebBSliKZI8iSzYpvmdUQgwST2dVv4toFYU1clp89h7_qj"'
            buildConfigField "Boolean", "kIsVerificationEnabled", "false"
        }
        dev {
            applicationId "com.trx.consumer.dev"
            buildConfigField "boolean", "DEVELOPMENT", "true"
            buildConfigField "String", "kBaseUrl", '"https://trx-dashboard-dev.vercel.app/api/"'
            buildConfigField "Boolean", "isReportingDisabled", "false"
            buildConfigField "Integer", "kFirebaseFetchInterval", "3"
            buildConfigField "String", "kStripeApiKey", '"pk_test_VG0f1gcydmawXMMYQSydPkw500ipbL8dW8"'
            signingConfig signingConfigs.devRelease
        }
        prod {
            applicationId "com.trx.consumer"
            buildConfigField "boolean", "DEVELOPMENT", "false"
            buildConfigField "String", "kBaseUrl", '"https://digital.trxtraining.com/api/"'
            buildConfigField "Boolean", "isReportingDisabled", "true"
            buildConfigField "Integer", "kFirebaseFetchInterval", "30"
            buildConfigField "String", "kStripeApiKey", '"pk_live_Nrhi2HdHwsfQ5OSiPhhtwuah00yvGgjwWe"'
            signingConfig signingConfigs.prodRelease
        }
    }
    sourceSets {
        devDebug {
            assets {
                srcDirs 'src/devDebug/assets'
            }
        }
    }
}

dependencies {

    // AndroidX
    implementation "androidx.activity:activity-ktx:$rootProject.activityKtxVersion"
    implementation "androidx.appcompat:appcompat:$rootProject.appCompatVersion"
    implementation "androidx.constraintlayout:constraintlayout:$rootProject.constraintLayoutVersion"
    implementation "androidx.core:core-ktx:$rootProject.coreKtxVersion"
    implementation "androidx.datastore:datastore-preferences:$rootProject.dataStoreVersion"
    implementation "androidx.fragment:fragment-ktx:$rootProject.fragmentKtxVersion"
    implementation "androidx.lifecycle:lifecycle-extensions:$rootProject.lifecycleVersion"
    implementation "androidx.lifecycle:lifecycle-viewmodel-ktx:$rootProject.lifecycleVersion"
    implementation "androidx.lifecycle:lifecycle-common-java8:$rootProject.lifecycleVersion"
    implementation "androidx.swiperefreshlayout:swiperefreshlayout:$rootProject.swipeRefreshLayoutVersion"
    implementation "androidx.viewpager2:viewpager2:$rootProject.viewPager2Version"
    implementation "androidx.work:work-runtime:$rootProject.workVersion"
    implementation "androidx.work:work-runtime-ktx:$rootProject.workVersion"
    implementation "androidx.work:work-rxjava2:$rootProject.workVersion"

    implementation "com.google.android.material:material:$rootProject.materialVersion"
    implementation "com.jakewharton.timber:timber:$rootProject.timberVersion"
    implementation "com.airbnb.android:lottie:$rootProject.lottieVersion"

    // Kotlin
    implementation "org.jetbrains.kotlin:kotlin-stdlib-jdk8:$rootProject.kotlinVersion"
    implementation "org.jetbrains.kotlinx:kotlinx-coroutines-android:$rootProject.coroutinesVersion"

    // Network
    implementation "com.squareup.okhttp3:okhttp:$rootProject.okHttpVersion"
    implementation "com.squareup.okhttp3:logging-interceptor:$rootProject.okHttpVersion"
    implementation "com.squareup.retrofit2:retrofit:$rootProject.retrofitVersion"
    implementation "com.squareup.retrofit2:converter-gson:$rootProject.retrofitVersion"

    // Schedule
    implementation "com.github.alamkanak:android-week-view:$rootProject.weekVersion"
    implementation "com.github.kizitonwose:CalendarView:$rootProject.calendarVersion"

    // Glide
    implementation "com.github.bumptech.glide:glide:$rootProject.glideVersion"
    annotationProcessor "com.github.bumptech.glide:compiler:$rootProject.glideVersion"

    // Stripe Android SDK
    implementation 'com.stripe:stripe-android:16.8.0'

    // Navigation graph
    implementation "androidx.navigation:navigation-fragment-ktx:$rootProject.navGraphVersion"
    implementation "androidx.navigation:navigation-ui-ktx:$rootProject.navGraphVersion"

    // Dependency Injection
    implementation "com.google.dagger:hilt-android:$hiltVersion"
    kapt "com.google.dagger:hilt-android-compiler:$hiltVersion"
    implementation "androidx.hilt:hilt-lifecycle-viewmodel:$rootProject.hiltViewModelversion"
    kapt "androidx.hilt:hilt-compiler:$rootProject.hiltViewModelversion"

    // Video playback
    implementation "com.brightcove.player:exoplayer2:$rootProject.brightcoveVersion"

    // Testing dependencies
    androidTestImplementation "androidx.test.ext:junit:$rootProject.junitVersion"
    androidTestImplementation "org.mockito:mockito-android:$rootProject.mockitoVersion"

    testImplementation "org.jetbrains.kotlinx:kotlinx-coroutines-test:$rootProject.coroutinesTestVersion"
    testImplementation "androidx.arch.core:core-testing:$rootProject.coreTestingVersion"
    testImplementation "org.mockito:mockito-inline:$rootProject.mockitoVersion"
    testImplementation "com.nhaarman.mockitokotlin2:mockito-kotlin:$rootProject.mockitoKotlinVersion"
    testImplementation "androidx.test.ext:junit:$rootProject.junitVersion"
    testImplementation "org.json:json:${rootProject.jsonTestVersion}"

    coreLibraryDesugaring "com.android.tools:desugar_jdk_libs:$rootProject.desugarVersion"
}
